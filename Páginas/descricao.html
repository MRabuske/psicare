<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>DescriÃ§Ã£o - PsiCare</title>
  <link rel="website icon" href="./Imagens/Logo-PsiCare.png">
  <link rel="stylesheet" href="../style1.css">
</head>
<body>
  <div class="container">
      <a href="../index.html">
        <img src="./Imagens/Logo-PsiCare.png" alt="Logo-PsiCare" class="Logo-PsiCare">
      </a>
    <div class="header">
      <h1>PsiCare</h1>
      <div class="data"><span id="data-hoje"></span></div>
    </div>

    <div class="humor-section">
      <h4>Como estÃ¡ seu humor hoje?</h4>
      <span class="humor-option">ğŸ˜¢</span>
      <span class="humor-option">ğŸ˜Ÿ</span>
      <span class="humor-option">ğŸ˜</span>
      <span class="humor-option">ğŸ™‚</span>
      <span class="humor-option">ğŸ˜</span>
    </div>

    <textarea id="descricao" placeholder="Descreva aqui como vocÃª se sente hoje..."></textarea>

    <div class="buttons">
      <button class="limpar" onclick="limpar()">Limpar</button>
      <button class="salvar" onclick="salvar()">Salvar</button>
    </div>

    <div class="footer">
      <a href="ltees29@gmail.com">
      <img src="https://img.icons8.com/ios-filled/50/settings.png" alt="ConfiguraÃ§Ãµes"/>
      </a>
      <img src="https://img.icons8.com/ios-filled/50/technical-support.png" alt="Suporte TÃ©cnico"/>
    </div>
  </div>

  <script src="../script.js"></script>
  <script>
    async function salvar() {
      const descricao = descricaoInput.value.trim();
      if (!humorSelecionado || !descricao) {
        alert("Selecione um humor e escreva uma descriÃ§Ã£o.");
        return;
      }

      const token = localStorage.getItem("token");
      if (!token) {
        alert("VocÃª precisa estar logado.");
        window.location.href = "./Entrar.html";
        return;
      }

      try {
        const response = await fetch("http://localhost:3000/emocao", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": `Bearer ${token}`
          },
          body: JSON.stringify({
            mood: humorSelecionado,
            description: descricao
          })
        });

        if (!response.ok) {
          const data = await response.json();
          alert(data.message || "Erro ao salvar emoÃ§Ã£o.");
          return;
        }

        alert("Registro salvo com sucesso!");
        window.location.href = "./historico.html";
      } catch (err) {
        alert("Erro de conexÃ£o com o servidor.");
      }
    }
  </script>
</body>
</html>